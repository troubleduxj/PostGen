# è®¾è®¡æ¨¡æ¿ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

æœ¬è®¾è®¡æ–‡æ¡£æè¿°äº†ä¸ºç”»æ¿è®¾è®¡åˆ†ç±»åˆ›å»ºå®Œæ•´æ¨¡æ¿ç¤ºä¾‹ç³»ç»Ÿçš„æŠ€æœ¯æ–¹æ¡ˆã€‚ç³»ç»Ÿå°†ä¸ºæ¯ä¸ªç”»å¸ƒå°ºå¯¸é¢„è®¾æä¾›ä¸°å¯Œçš„ä¸“ä¸šè®¾è®¡æ¨¡æ¿ï¼ŒåŒ…æ‹¬ç¤¾äº¤åª’ä½“ã€å°åˆ·å“ã€æ¼”ç¤ºæ–‡ç¨¿ã€æ•°å­—è¥é”€ã€ç§»åŠ¨ç«¯ç­‰å¤šä¸ªåˆ†ç±»çš„æ¨¡æ¿åº“ã€‚

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¨¡æ¿ç³»ç»Ÿæ¶æ„                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ¨¡æ¿é€‰æ‹©å™¨  â”‚  æ¨¡æ¿é¢„è§ˆå™¨  â”‚  æ¨¡æ¿ç¼–è¾‘å™¨  â”‚  æ¨¡æ¿ç®¡ç†å™¨      â”‚
â”‚ TemplateSelector â”‚ TemplatePreview â”‚ TemplateEditor â”‚ TemplateManager â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   æ¨¡æ¿å¼•æ“å±‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TemplateEngine â”‚ TemplateRenderer â”‚ TemplateParser â”‚ TemplateValidator â”‚
â”‚   æ¨¡æ¿å¼•æ“     â”‚    æ¨¡æ¿æ¸²æŸ“å™¨     â”‚   æ¨¡æ¿è§£æå™¨    â”‚   æ¨¡æ¿éªŒè¯å™¨      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   æ•°æ®ç®¡ç†å±‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TemplateStore â”‚ CategoryStore â”‚ RecommendationEngine â”‚ SearchEngine â”‚
â”‚   æ¨¡æ¿å­˜å‚¨     â”‚   åˆ†ç±»å­˜å‚¨     â”‚     æ¨èå¼•æ“         â”‚   æœç´¢å¼•æ“    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   æ•°æ®å­˜å‚¨å±‚                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¢„è®¾æ¨¡æ¿åº“   â”‚  ç”¨æˆ·æ¨¡æ¿åº“   â”‚  æ¨¡æ¿å…ƒæ•°æ®   â”‚   ç¼“å­˜ç³»ç»Ÿ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶è®¾è®¡

#### 1. æ¨¡æ¿æ•°æ®ç»“æ„

```typescript
// æ¨¡æ¿åŸºç¡€æ¥å£
interface DesignTemplate {
  id: string;
  name: string;
  description: string;
  category: TemplateCategory;
  subcategory?: string;
  
  // ç”»å¸ƒä¿¡æ¯
  canvas: {
    width: number;
    height: number;
    backgroundColor: string;
    backgroundImage?: string;
  };
  
  // è®¾è®¡å…ƒç´ 
  objects: TemplateObject[];
  
  // å…ƒæ•°æ®
  metadata: {
    tags: string[];
    style: TemplateStyle;
    industry: string[];
    difficulty: 'beginner' | 'intermediate' | 'advanced';
    colors: string[]; // ä¸»è¦é¢œè‰²
    fonts: string[]; // ä½¿ç”¨çš„å­—ä½“
    createdAt: string;
    updatedAt: string;
    author: string;
    version: string;
  };
  
  // é¢„è§ˆä¿¡æ¯
  preview: {
    thumbnail: string; // ç¼©ç•¥å›¾URL
    fullPreview: string; // å®Œæ•´é¢„è§ˆå›¾URL
    description: string; // ä½¿ç”¨åœºæ™¯æè¿°
  };
  
  // è‡ªå®šä¹‰å±æ€§
  customizable: {
    colors: boolean; // æ˜¯å¦æ”¯æŒé¢œè‰²æ›¿æ¢
    fonts: boolean; // æ˜¯å¦æ”¯æŒå­—ä½“æ›¿æ¢
    images: boolean; // æ˜¯å¦æ”¯æŒå›¾ç‰‡æ›¿æ¢
    text: boolean; // æ˜¯å¦æ”¯æŒæ–‡æœ¬ç¼–è¾‘
  };
}

// æ¨¡æ¿å¯¹è±¡æ¥å£
interface TemplateObject {
  id: string;
  type: 'text' | 'image' | 'shape' | 'group';
  fabricObject: any; // Fabric.jså¯¹è±¡åºåˆ—åŒ–æ•°æ®
  
  // å¯ç¼–è¾‘å±æ€§
  editable: {
    content: boolean; // å†…å®¹æ˜¯å¦å¯ç¼–è¾‘
    style: boolean; // æ ·å¼æ˜¯å¦å¯ç¼–è¾‘
    position: boolean; // ä½ç½®æ˜¯å¦å¯ç¼–è¾‘
    size: boolean; // å¤§å°æ˜¯å¦å¯ç¼–è¾‘
  };
  
  // å ä½ç¬¦ä¿¡æ¯ï¼ˆç”¨äºæ™ºèƒ½æ›¿æ¢ï¼‰
  placeholder?: {
    type: 'text' | 'image' | 'logo' | 'icon';
    defaultContent: string;
    suggestions: string[]; // å†…å®¹å»ºè®®
  };
}

// æ¨¡æ¿åˆ†ç±»æšä¸¾
enum TemplateCategory {
  SOCIAL_MEDIA = 'social_media',
  PRINT = 'print',
  PRESENTATION = 'presentation',
  DIGITAL_MARKETING = 'digital_marketing',
  MOBILE = 'mobile',
  CUSTOM = 'custom'
}

// æ¨¡æ¿é£æ ¼æšä¸¾
enum TemplateStyle {
  MODERN = 'modern',
  VINTAGE = 'vintage',
  MINIMAL = 'minimal',
  CREATIVE = 'creative',
  PROFESSIONAL = 'professional',
  PLAYFUL = 'playful',
  ELEGANT = 'elegant',
  BOLD = 'bold'
}
```

#### 2. æ¨¡æ¿å¼•æ“è®¾è®¡

```typescript
// æ¨¡æ¿å¼•æ“æ ¸å¿ƒç±»
class TemplateEngine {
  private templateStore: TemplateStore;
  private canvas: fabric.Canvas;
  
  // åº”ç”¨æ¨¡æ¿åˆ°ç”»å¸ƒ
  async applyTemplate(templateId: string): Promise<void> {
    const template = await this.templateStore.getTemplate(templateId);
    await this.clearCanvas();
    await this.renderTemplate(template);
    this.setupEditableElements(template);
  }
  
  // æ¸²æŸ“æ¨¡æ¿
  private async renderTemplate(template: DesignTemplate): Promise<void> {
    // è®¾ç½®ç”»å¸ƒèƒŒæ™¯
    this.setupCanvasBackground(template.canvas);
    
    // æ¸²æŸ“æ‰€æœ‰å¯¹è±¡
    for (const obj of template.objects) {
      const fabricObject = await this.createFabricObject(obj);
      this.canvas.add(fabricObject);
    }
    
    this.canvas.renderAll();
  }
  
  // åˆ›å»ºFabric.jså¯¹è±¡
  private async createFabricObject(templateObj: TemplateObject): Promise<fabric.Object> {
    switch (templateObj.type) {
      case 'text':
        return this.createTextObject(templateObj);
      case 'image':
        return await this.createImageObject(templateObj);
      case 'shape':
        return this.createShapeObject(templateObj);
      case 'group':
        return await this.createGroupObject(templateObj);
      default:
        throw new Error(`Unknown object type: ${templateObj.type}`);
    }
  }
  
  // è®¾ç½®å¯ç¼–è¾‘å…ƒç´ 
  private setupEditableElements(template: DesignTemplate): void {
    template.objects.forEach(obj => {
      if (obj.editable.content || obj.placeholder) {
        this.setupPlaceholder(obj);
      }
    });
  }
}
```

#### 3. æ¨¡æ¿å­˜å‚¨ç³»ç»Ÿ

```typescript
// æ¨¡æ¿å­˜å‚¨æ¥å£
interface TemplateStore {
  // è·å–æ¨¡æ¿
  getTemplate(id: string): Promise<DesignTemplate>;
  getTemplatesByCategory(category: TemplateCategory): Promise<DesignTemplate[]>;
  getTemplatesBySize(width: number, height: number): Promise<DesignTemplate[]>;
  
  // æœç´¢æ¨¡æ¿
  searchTemplates(query: TemplateSearchQuery): Promise<TemplateSearchResult>;
  
  // ç”¨æˆ·æ¨¡æ¿ç®¡ç†
  saveUserTemplate(template: DesignTemplate): Promise<string>;
  getUserTemplates(userId: string): Promise<DesignTemplate[]>;
  deleteUserTemplate(templateId: string): Promise<void>;
  
  // æ¨¡æ¿æ¨è
  getRecommendedTemplates(criteria: RecommendationCriteria): Promise<DesignTemplate[]>;
  getTrendingTemplates(): Promise<DesignTemplate[]>;
}

// æœç´¢æŸ¥è¯¢æ¥å£
interface TemplateSearchQuery {
  keyword?: string;
  category?: TemplateCategory;
  style?: TemplateStyle;
  colors?: string[];
  industry?: string[];
  size?: { width: number; height: number };
  tags?: string[];
  difficulty?: string;
}

// æ¨èæ ‡å‡†æ¥å£
interface RecommendationCriteria {
  canvasSize: { width: number; height: number };
  userHistory: string[]; // ç”¨æˆ·ä½¿ç”¨è¿‡çš„æ¨¡æ¿ID
  preferredStyles: TemplateStyle[];
  industry?: string;
  keywords?: string[];
  brandColors?: string[];
}
```

## ç»„ä»¶å’Œæ¥å£è®¾è®¡

### 1. æ¨¡æ¿é€‰æ‹©å™¨ç»„ä»¶

```typescript
// ä¸»æ¨¡æ¿é€‰æ‹©å™¨
const TemplateSelector: React.FC<TemplateSelectorProps> = ({
  canvasSize,
  onTemplateSelect,
  onClose
}) => {
  const [selectedCategory, setSelectedCategory] = useState<TemplateCategory>();
  const [searchQuery, setSearchQuery] = useState<string>('');
  const [filters, setFilters] = useState<TemplateFilters>({});
  
  return (
    <div className="template-selector">
      <TemplateSelectorHeader 
        onSearch={setSearchQuery}
        onClose={onClose}
      />
      
      <div className="template-selector-body">
        <TemplateCategoryNav 
          selectedCategory={selectedCategory}
          onCategorySelect={setSelectedCategory}
        />
        
        <TemplateFilters 
          filters={filters}
          onFiltersChange={setFilters}
        />
        
        <TemplateGrid 
          category={selectedCategory}
          searchQuery={searchQuery}
          filters={filters}
          canvasSize={canvasSize}
          onTemplateSelect={onTemplateSelect}
        />
      </div>
    </div>
  );
};

// æ¨¡æ¿ç½‘æ ¼ç»„ä»¶
const TemplateGrid: React.FC<TemplateGridProps> = ({
  category,
  searchQuery,
  filters,
  canvasSize,
  onTemplateSelect
}) => {
  const { templates, loading, error } = useTemplates({
    category,
    searchQuery,
    filters,
    canvasSize
  });
  
  if (loading) return <TemplateGridSkeleton />;
  if (error) return <TemplateGridError error={error} />;
  
  return (
    <div className="template-grid">
      {templates.map(template => (
        <TemplateCard 
          key={template.id}
          template={template}
          onSelect={() => onTemplateSelect(template)}
        />
      ))}
    </div>
  );
};
```

### 2. æ¨¡æ¿å¡ç‰‡ç»„ä»¶

```typescript
// æ¨¡æ¿å¡ç‰‡
const TemplateCard: React.FC<TemplateCardProps> = ({ 
  template, 
  onSelect,
  onPreview,
  onFavorite 
}) => {
  const [isHovered, setIsHovered] = useState(false);
  const [isFavorited, setIsFavorited] = useState(false);
  
  return (
    <div 
      className="template-card"
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
    >
      <div className="template-card-preview">
        <img 
          src={template.preview.thumbnail}
          alt={template.name}
          loading="lazy"
        />
        
        {isHovered && (
          <div className="template-card-overlay">
            <button onClick={() => onPreview(template)}>
              é¢„è§ˆ
            </button>
            <button onClick={() => onSelect(template)}>
              ä½¿ç”¨æ¨¡æ¿
            </button>
          </div>
        )}
        
        <button 
          className={`template-card-favorite ${isFavorited ? 'active' : ''}`}
          onClick={() => onFavorite(template)}
        >
          â¤ï¸
        </button>
      </div>
      
      <div className="template-card-info">
        <h3>{template.name}</h3>
        <p>{template.preview.description}</p>
        
        <div className="template-card-tags">
          {template.metadata.tags.slice(0, 3).map(tag => (
            <span key={tag} className="tag">{tag}</span>
          ))}
        </div>
        
        <div className="template-card-meta">
          <span className="style">{template.metadata.style}</span>
          <span className="difficulty">{template.metadata.difficulty}</span>
        </div>
      </div>
    </div>
  );
};
```

### 3. æ¨¡æ¿é¢„è§ˆå™¨ç»„ä»¶

```typescript
// æ¨¡æ¿é¢„è§ˆå™¨
const TemplatePreview: React.FC<TemplatePreviewProps> = ({
  template,
  onApply,
  onClose
}) => {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const [previewCanvas, setPreviewCanvas] = useState<fabric.Canvas | null>(null);
  
  useEffect(() => {
    if (canvasRef.current) {
      const canvas = new fabric.Canvas(canvasRef.current);
      setPreviewCanvas(canvas);
      
      // æ¸²æŸ“æ¨¡æ¿é¢„è§ˆ
      renderTemplatePreview(canvas, template);
    }
    
    return () => {
      previewCanvas?.dispose();
    };
  }, [template]);
  
  return (
    <div className="template-preview-modal">
      <div className="template-preview-header">
        <h2>{template.name}</h2>
        <button onClick={onClose}>Ã—</button>
      </div>
      
      <div className="template-preview-body">
        <div className="template-preview-canvas">
          <canvas ref={canvasRef} />
        </div>
        
        <div className="template-preview-info">
          <TemplateInfo template={template} />
          <TemplateCustomizationOptions template={template} />
          
          <div className="template-preview-actions">
            <button 
              className="btn-primary"
              onClick={() => onApply(template)}
            >
              ä½¿ç”¨æ­¤æ¨¡æ¿
            </button>
            <button className="btn-secondary">
              æ”¶è—æ¨¡æ¿
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};
```

### 4. æ¨¡æ¿ç®¡ç†å™¨ç»„ä»¶

```typescript
// ç”¨æˆ·æ¨¡æ¿ç®¡ç†å™¨
const TemplateManager: React.FC = () => {
  const [userTemplates, setUserTemplates] = useState<DesignTemplate[]>([]);
  const [selectedTemplates, setSelectedTemplates] = useState<string[]>([]);
  
  return (
    <div className="template-manager">
      <div className="template-manager-header">
        <h2>æˆ‘çš„æ¨¡æ¿</h2>
        <div className="template-manager-actions">
          <button onClick={handleImportTemplate}>
            å¯¼å…¥æ¨¡æ¿
          </button>
          <button onClick={handleExportSelected}>
            å¯¼å‡ºé€‰ä¸­
          </button>
          <button onClick={handleDeleteSelected}>
            åˆ é™¤é€‰ä¸­
          </button>
        </div>
      </div>
      
      <div className="template-manager-body">
        <TemplateManagerGrid 
          templates={userTemplates}
          selectedTemplates={selectedTemplates}
          onSelectionChange={setSelectedTemplates}
        />
      </div>
    </div>
  );
};
```

## æ•°æ®æ¨¡å‹è®¾è®¡

### 1. é¢„è®¾æ¨¡æ¿æ•°æ®ç»“æ„

```typescript
// ç¤¾äº¤åª’ä½“æ¨¡æ¿ç¤ºä¾‹
const socialMediaTemplates: DesignTemplate[] = [
  {
    id: 'instagram-post-modern-1',
    name: 'ç°ä»£ç®€çº¦Instagramå¸–å­',
    description: 'é€‚åˆå“ç‰Œæ¨å¹¿çš„ç°ä»£ç®€çº¦é£æ ¼Instagramå¸–å­æ¨¡æ¿',
    category: TemplateCategory.SOCIAL_MEDIA,
    subcategory: 'instagram-post',
    
    canvas: {
      width: 1080,
      height: 1080,
      backgroundColor: '#ffffff'
    },
    
    objects: [
      {
        id: 'background-shape',
        type: 'shape',
        fabricObject: {
          type: 'rect',
          width: 1080,
          height: 540,
          fill: '#667eea',
          top: 0,
          left: 0
        },
        editable: {
          content: false,
          style: true,
          position: false,
          size: false
        }
      },
      {
        id: 'main-title',
        type: 'text',
        fabricObject: {
          type: 'text',
          text: 'æ‚¨çš„æ ‡é¢˜æ–‡å­—',
          fontSize: 48,
          fontFamily: 'Arial',
          fill: '#ffffff',
          top: 200,
          left: 540,
          originX: 'center',
          originY: 'center'
        },
        editable: {
          content: true,
          style: true,
          position: true,
          size: true
        },
        placeholder: {
          type: 'text',
          defaultContent: 'æ‚¨çš„æ ‡é¢˜æ–‡å­—',
          suggestions: ['æ–°å“å‘å¸ƒ', 'é™æ—¶ä¼˜æƒ ', 'å“ç‰Œæ•…äº‹']
        }
      }
      // ... æ›´å¤šå¯¹è±¡
    ],
    
    metadata: {
      tags: ['ç°ä»£', 'ç®€çº¦', 'å“ç‰Œ', 'Instagram'],
      style: TemplateStyle.MODERN,
      industry: ['ç§‘æŠ€', 'æ—¶å°š', 'ç”Ÿæ´»æ–¹å¼'],
      difficulty: 'beginner',
      colors: ['#667eea', '#764ba2', '#ffffff'],
      fonts: ['Arial', 'Helvetica'],
      createdAt: '2024-01-01T00:00:00Z',
      updatedAt: '2024-01-01T00:00:00Z',
      author: 'Design Team',
      version: '1.0'
    },
    
    preview: {
      thumbnail: '/templates/thumbnails/instagram-post-modern-1.jpg',
      fullPreview: '/templates/previews/instagram-post-modern-1.jpg',
      description: 'ç°ä»£ç®€çº¦é£æ ¼ï¼Œé€‚åˆç§‘æŠ€å’Œæ—¶å°šå“ç‰Œä½¿ç”¨'
    },
    
    customizable: {
      colors: true,
      fonts: true,
      images: true,
      text: true
    }
  }
  // ... æ›´å¤šæ¨¡æ¿
];
```

### 2. æ¨¡æ¿åˆ†ç±»é…ç½®

```typescript
// æ¨¡æ¿åˆ†ç±»é…ç½®
const templateCategories = {
  [TemplateCategory.SOCIAL_MEDIA]: {
    name: 'ç¤¾äº¤åª’ä½“',
    icon: 'ğŸ“±',
    subcategories: {
      'instagram-post': { name: 'Instagramå¸–å­', size: { width: 1080, height: 1080 } },
      'instagram-story': { name: 'Instagramæ•…äº‹', size: { width: 1080, height: 1920 } },
      'facebook-post': { name: 'Facebookå¸–å­', size: { width: 1200, height: 630 } },
      'twitter-header': { name: 'Twitterå¤´å›¾', size: { width: 1500, height: 500 } },
      'linkedin-post': { name: 'LinkedInå¸–å­', size: { width: 1200, height: 627 } },
      'youtube-thumbnail': { name: 'YouTubeç¼©ç•¥å›¾', size: { width: 1280, height: 720 } }
    }
  },
  
  [TemplateCategory.PRINT]: {
    name: 'å°åˆ·å“',
    icon: 'ğŸ–¨ï¸',
    subcategories: {
      'flyer-a4': { name: 'A4ä¼ å•', size: { width: 2480, height: 3508 } },
      'business-card': { name: 'åç‰‡', size: { width: 1050, height: 600 } },
      'poster-a3': { name: 'A3æµ·æŠ¥', size: { width: 3508, height: 4961 } },
      'brochure': { name: 'å®£ä¼ å†Œ', size: { width: 2480, height: 3508 } },
      'invitation': { name: 'é‚€è¯·å‡½', size: { width: 1500, height: 2100 } },
      'certificate': { name: 'è¯ä¹¦', size: { width: 3508, height: 2480 } }
    }
  },
  
  [TemplateCategory.PRESENTATION]: {
    name: 'æ¼”ç¤ºæ–‡ç¨¿',
    icon: 'ğŸ“Š',
    subcategories: {
      'ppt-standard': { name: 'PPTæ ‡å‡†', size: { width: 1024, height: 768 } },
      'ppt-widescreen': { name: 'PPTå®½å±', size: { width: 1920, height: 1080 } },
      'keynote': { name: 'Keynote', size: { width: 1920, height: 1080 } },
      'google-slides': { name: 'Google Slides', size: { width: 1920, height: 1080 } }
    }
  }
  // ... å…¶ä»–åˆ†ç±»
};
```

## é”™è¯¯å¤„ç†ç­–ç•¥

### 1. æ¨¡æ¿åŠ è½½é”™è¯¯å¤„ç†

```typescript
class TemplateErrorHandler {
  // å¤„ç†æ¨¡æ¿åŠ è½½å¤±è´¥
  static handleTemplateLoadError(error: Error, templateId: string): void {
    console.error(`Failed to load template ${templateId}:`, error);
    
    // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯ä¿¡æ¯
    NotificationService.showError('æ¨¡æ¿åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
    
    // è®°å½•é”™è¯¯æ—¥å¿—
    ErrorLogger.log('template_load_error', {
      templateId,
      error: error.message,
      timestamp: new Date().toISOString()
    });
    
    // æä¾›é™çº§æ–¹æ¡ˆ
    this.showFallbackTemplate();
  }
  
  // å¤„ç†æ¨¡æ¿åº”ç”¨é”™è¯¯
  static handleTemplateApplyError(error: Error, template: DesignTemplate): void {
    console.error('Failed to apply template:', error);
    
    // å°è¯•æ¢å¤ç”»å¸ƒçŠ¶æ€
    CanvasStateManager.restorePreviousState();
    
    // æ˜¾ç¤ºé”™è¯¯æç¤º
    NotificationService.showError('æ¨¡æ¿åº”ç”¨å¤±è´¥ï¼Œå·²æ¢å¤åˆ°ä¹‹å‰çŠ¶æ€');
  }
}
```

### 2. æ•°æ®éªŒè¯å’Œå…¼å®¹æ€§å¤„ç†

```typescript
class TemplateValidator {
  // éªŒè¯æ¨¡æ¿æ•°æ®å®Œæ•´æ€§
  static validateTemplate(template: DesignTemplate): ValidationResult {
    const errors: string[] = [];
    
    // éªŒè¯å¿…éœ€å­—æ®µ
    if (!template.id) errors.push('æ¨¡æ¿IDä¸èƒ½ä¸ºç©º');
    if (!template.name) errors.push('æ¨¡æ¿åç§°ä¸èƒ½ä¸ºç©º');
    if (!template.canvas) errors.push('ç”»å¸ƒé…ç½®ä¸èƒ½ä¸ºç©º');
    
    // éªŒè¯å¯¹è±¡æ•°æ®
    template.objects.forEach((obj, index) => {
      if (!obj.fabricObject) {
        errors.push(`å¯¹è±¡ ${index} ç¼ºå°‘Fabric.jsæ•°æ®`);
      }
    });
    
    return {
      isValid: errors.length === 0,
      errors
    };
  }
  
  // å¤„ç†ç‰ˆæœ¬å…¼å®¹æ€§
  static migrateTemplate(template: any, fromVersion: string): DesignTemplate {
    // æ ¹æ®ç‰ˆæœ¬è¿›è¡Œæ•°æ®è¿ç§»
    switch (fromVersion) {
      case '1.0':
        return this.migrateFromV1(template);
      case '2.0':
        return this.migrateFromV2(template);
      default:
        return template;
    }
  }
}
```

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. æ¨¡æ¿åŠ è½½ä¼˜åŒ–

```typescript
class TemplateLoadingOptimizer {
  private static templateCache = new Map<string, DesignTemplate>();
  private static preloadQueue: string[] = [];
  
  // é¢„åŠ è½½çƒ­é—¨æ¨¡æ¿
  static async preloadPopularTemplates(): Promise<void> {
    const popularTemplateIds = await TemplateAnalytics.getPopularTemplateIds();
    
    for (const templateId of popularTemplateIds) {
      if (!this.templateCache.has(templateId)) {
        this.preloadQueue.push(templateId);
      }
    }
    
    // æ‰¹é‡é¢„åŠ è½½
    await this.batchPreload();
  }
  
  // æ‡’åŠ è½½æ¨¡æ¿ç¼©ç•¥å›¾
  static setupLazyLoading(): void {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target as HTMLImageElement;
          img.src = img.dataset.src!;
          observer.unobserve(img);
        }
      });
    });
    
    document.querySelectorAll('img[data-src]').forEach(img => {
      observer.observe(img);
    });
  }
}
```

### 2. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

```typescript
class TemplateRenderOptimizer {
  // è™šæ‹ŸåŒ–æ¨¡æ¿ç½‘æ ¼
  static createVirtualizedGrid(templates: DesignTemplate[]): React.ComponentType {
    return () => {
      const { height, width } = useWindowSize();
      const itemHeight = 300;
      const itemWidth = 250;
      
      return (
        <FixedSizeGrid
          height={height - 200}
          width={width}
          columnCount={Math.floor(width / itemWidth)}
          columnWidth={itemWidth}
          rowCount={Math.ceil(templates.length / Math.floor(width / itemWidth))}
          rowHeight={itemHeight}
          itemData={templates}
        >
          {TemplateGridItem}
        </FixedSizeGrid>
      );
    };
  }
  
  // ä¼˜åŒ–Canvasæ¸²æŸ“
  static optimizeCanvasRendering(canvas: fabric.Canvas): void {
    // ç¦ç”¨ä¸å¿…è¦çš„æ¸²æŸ“
    canvas.renderOnAddRemove = false;
    canvas.skipTargetFind = true;
    
    // æ‰¹é‡æ¸²æŸ“
    canvas.requestRenderAll = debounce(canvas.requestRenderAll.bind(canvas), 16);
  }
}
```

## æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

```typescript
// æ¨¡æ¿å¼•æ“æµ‹è¯•
describe('TemplateEngine', () => {
  let templateEngine: TemplateEngine;
  let mockCanvas: fabric.Canvas;
  
  beforeEach(() => {
    mockCanvas = new fabric.Canvas(document.createElement('canvas'));
    templateEngine = new TemplateEngine(mockCanvas);
  });
  
  test('should apply template correctly', async () => {
    const template = createMockTemplate();
    await templateEngine.applyTemplate(template.id);
    
    expect(mockCanvas.getObjects()).toHaveLength(template.objects.length);
  });
  
  test('should handle template loading errors', async () => {
    const invalidTemplateId = 'invalid-template';
    
    await expect(templateEngine.applyTemplate(invalidTemplateId))
      .rejects.toThrow('Template not found');
  });
});
```

### 2. é›†æˆæµ‹è¯•

```typescript
// æ¨¡æ¿é€‰æ‹©å™¨é›†æˆæµ‹è¯•
describe('TemplateSelector Integration', () => {
  test('should load and display templates by category', async () => {
    render(<TemplateSelector canvasSize={{ width: 1080, height: 1080 }} />);
    
    // é€‰æ‹©ç¤¾äº¤åª’ä½“åˆ†ç±»
    fireEvent.click(screen.getByText('ç¤¾äº¤åª’ä½“'));
    
    // ç­‰å¾…æ¨¡æ¿åŠ è½½
    await waitFor(() => {
      expect(screen.getByText('Instagramå¸–å­')).toBeInTheDocument();
    });
    
    // éªŒè¯æ¨¡æ¿å¡ç‰‡æ˜¾ç¤º
    const templateCards = screen.getAllByTestId('template-card');
    expect(templateCards.length).toBeGreaterThan(0);
  });
});
```

è¿™ä¸ªè®¾è®¡æ–¹æ¡ˆæä¾›äº†å®Œæ•´çš„æ¨¡æ¿ç³»ç»Ÿæ¶æ„ï¼ŒåŒ…æ‹¬æ•°æ®ç»“æ„ã€ç»„ä»¶è®¾è®¡ã€æ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯å¤„ç†ç­–ç•¥ï¼Œç¡®ä¿ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œç”¨æˆ·ä½“éªŒã€‚